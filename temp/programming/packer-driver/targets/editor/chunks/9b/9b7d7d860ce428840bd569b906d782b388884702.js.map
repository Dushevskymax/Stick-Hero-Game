{"version":3,"sources":["file:///C:/Users/user/StickHero/assets/scripts/StickController.ts"],"names":["StickController","constructor","model","view","currentScaleY","startGrowing","setStickGrowing","startColumnInfo","getStartColumnInfo","startX","x","width","startY","height","createStick","updateStick","getStickAngle","stopGrowing","dropStick","checkResult","update","deltaTime","isStickGrowing","stickInfo","getStickInfo","maxScaleY","getMaxHeight","getGrowthSpeed","nextColumnInfo","getNextColumnInfo","startRightX","stickLength","scaleY","stickEndX","nextLeftX","nextRightX","console","log","playerWidth","getPlayerWidth","playerX","setPlayerX","movePlayer","playerFall","showGameOverScreen","error"],"mappings":"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","sourcesContent":["import { IGameModel, IGameView } from './Interfaces';\r\n\r\n\r\nexport class StickController {\r\n    private model: IGameModel;\r\n    private view: IGameView;\r\n    private currentScaleY: number = 0;\r\n\r\n    constructor(model: IGameModel, view: IGameView) {\r\n        this.model = model;\r\n        this.view = view;\r\n    }\r\n\r\n    // Начать рост палки\r\n    startGrowing() {\r\n        this.model.setStickGrowing(true);\r\n        this.currentScaleY = 0;\r\n\r\n        const startColumnInfo = this.view.getStartColumnInfo();\r\n        const startX = startColumnInfo.x + startColumnInfo.width / 2;\r\n        const startY = startColumnInfo.height / 2;\r\n\r\n        this.view.createStick(startX, startY);\r\n        this.view.updateStick(this.currentScaleY, this.model.getStickAngle());\r\n    }\r\n\r\n    // Остановить рост палки\r\n    stopGrowing() {\r\n        this.model.setStickGrowing(false);\r\n        this.view.dropStick(() => this.checkResult());\r\n    }\r\n\r\n    // Обновить рост палки\r\n    update(deltaTime: number) {\r\n        if (!this.model.isStickGrowing()) return;\r\n\r\n        const stickInfo = this.view.getStickInfo();\r\n        const maxScaleY = this.view.getMaxHeight() / stickInfo.height;\r\n\r\n        this.currentScaleY += this.view.getGrowthSpeed() * deltaTime;\r\n\r\n        if (this.currentScaleY >= maxScaleY) {\r\n            this.currentScaleY = maxScaleY;\r\n            this.model.setStickGrowing(false);\r\n            this.view.dropStick(() => this.checkResult());\r\n        }\r\n\r\n        this.view.updateStick(this.currentScaleY, this.model.getStickAngle());\r\n    }\r\n\r\n    // Проверить результат\r\n    private checkResult() {\r\n        try {\r\n            const startColumnInfo = this.view.getStartColumnInfo();\r\n            const nextColumnInfo = this.view.getNextColumnInfo();\r\n            const stickInfo = this.view.getStickInfo();\r\n\r\n            const startRightX = startColumnInfo.x + startColumnInfo.width / 2;\r\n            const stickLength = stickInfo.height * stickInfo.scaleY;\r\n            const stickEndX = startRightX + stickLength;\r\n\r\n            const nextLeftX = nextColumnInfo.x - nextColumnInfo.width / 2;\r\n            const nextRightX = nextColumnInfo.x + nextColumnInfo.width / 2;\r\n\r\n            console.log(`Checking result: startRightX=${startRightX}, stickLength=${stickLength}, stickEndX=${stickEndX}, nextLeftX=${nextLeftX}, nextRightX=${nextRightX}`);\r\n\r\n            if (stickEndX >= nextLeftX && stickEndX <= nextRightX) {\r\n                const playerWidth = this.view.getPlayerWidth();\r\n                const playerX = nextColumnInfo.x + playerWidth / 4;\r\n                this.model.setPlayerX(playerX);\r\n                this.view.movePlayer(playerX);\r\n            } else {\r\n                this.view.playerFall(() => {\r\n                    this.view.showGameOverScreen();\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error in checkResult\", error);\r\n            this.view.showGameOverScreen();\r\n        }\r\n    }\r\n}"]}